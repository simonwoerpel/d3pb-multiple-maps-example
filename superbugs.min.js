"use strict";d3.json("./europe.topo.json",function(d){var geoData=topojson.feature(d,d.objects.europe_clipped);d3.csv("./superbugs.csv",function(d){var data=d;var columns=d.columns;d3.playbooks.choroplethMap.defaults({data:data,geoData:geoData,width:400,height:400,nullColor:"#eee",cssNamespace:"superbugs-map",responsiveSvg:true,getId:function getId(f){return f.properties.iso_a2},yExtent:[0,64],color:d3.schemeYlOrRd[9],drawExtra:function drawExtra(C){C.element.append("div").attr("class","superbugs-map__legend --delete-on-update").text("Resistance in %").append("ul").selectAll("li").data(C.getColor.quantiles()).enter().append("li").attr("class","superbugs-map__legend-item").text(function(d){return Math.round(d)}).append("span").style("background-color",function(d){return C.getColor(d)})}});var renderMap=function renderMap(yCol){var meta=META_DATA[yCol];var wrapper=d3.select(".main").append("div").attr("class","superbugs-map__container").attr("id",yCol);var title=wrapper.append("div").attr("class","superbugs-map__title");title.append("h3").text(meta.title);title.append("p").attr("class","subtitle").text(meta.subtitle);title.append("p").attr("class","desc").text(meta.text);title.append("p").append("a").attr("href",meta.url).text("more info");var map=d3.playbooks.choroplethMap({yCol:yCol,elementId:yCol}).render();var infoDiv=wrapper.append("div").attr("class","superbugs-map__info");if(meta.euData){d3.select("#"+yCol).select(".superbugs-map__wrapper").append("p").attr("class","eudata").text("EU: "+meta.euData+" %")}infoDiv.append("p").attr("class","source").text("Source: "+meta.source);return map};var MAPS=columns.filter(function(c){return c!=="id"}).map(function(c){return renderMap(c)});var schemeKeys=Object.keys(COLOR_SCHEMES);var changeScheme=function changeScheme(map,scheme){if(scheme==="__random__"){var i=Math.random()*schemeKeys.length|0;scheme=COLOR_SCHEMES[schemeKeys[i]]}map.color(scheme).update()};var switcher=d3.select(".colorswitcher");switcher.selectAll(".button").data(Object.keys(COLOR_SCHEMES)).enter().append("button").attr("class","colorswitcher__button").text(function(d){return d}).on("click",function(d){return MAPS.map(function(m){return changeScheme(m,COLOR_SCHEMES[d])})});switcher.append("button").attr("class","colorswitcher__button").text("RANDOM").on("click",function(d){return MAPS.map(function(m){return changeScheme(m,"__random__")})})})});var META_DATA={ecoli1:{title:"E. coli – Cephalosporins",subtitle:"Escherichia coli vs cephalosporins",text:"Resistance to 3rd generation cephalosporins in percent. Of all infections with this bacterium, this percentage was resistant to this antibiotic.",source:"ECDC Surveillance report 2014, except Poland (2013)",euData:12,url:"https://correctiv.org/en/investigations/superbugs/atlas/superbug-atlas-e-coli-cephalosporins/"},ecoli2:{title:"E. coli – Fluoroquinolones",subtitle:"Escherichia coli vs fluoroquinolones ",text:"Resistance to fluoroquinolones in percent. Of all infections with this bacterium, this percentage was resistant to this antibiotic.",source:"ECDC Surveillance report 2014, except Poland (2013)",euData:22.4,url:"https://correctiv.org/en/investigations/superbugs/atlas/superbug-atlas-e-coli-fluoroquinol/"},kp1:{title:"Klebsiella pneumoniae – Cephalosporins",subtitle:"Klebsiella pneumoniae vs cephalosporins",text:"Resistance to 3rd generation cephalosporins in percent. Of all infections with this bacterium, this percentage was resistant to this antibiotic.",euData:28,source:"ECDC Surveillance report 2014, except Poland (2013)",url:"https://correctiv.org/en/investigations/superbugs/atlas/superbug-atlas-klebsiella-cephalosporins/"},kp2:{title:"Klebsiella pneumoniae – Carbapenems",subtitle:"Klebsiella pneumoniae vs carbapenems",text:"Resistance to carbapenems in percent. Of all infections with this bacterium, this percentage was resistant to this antibiotic.",euData:7.3,source:"ECDC Surveillance report 2014, except Poland (2013)",url:"https://correctiv.org/en/investigations/superbugs/atlas/superbug-atlas-klebsiella-carbapenems/"},mrsa:{title:"MRSA",subtitle:"Staphylococcus aureus vs methicillin",text:"MRSA in percent. Of all infections with this bacterium, this percentage was resistant to this antibiotic.",euData:17.4,source:"ECDC Surveillance report 2014, except Poland (2013)",url:"https://correctiv.org/en/investigations/superbugs/atlas/superbug-atlas-mrsa/"},sp:{title:"Streptococcus pneumoniae – Penicillin",subtitle:"Streptococcus pneumoniae vs penicillin",text:"Resistance to penicillin in percent. Of all infections with this bacterium, this percentage was resistant to this antibiotic.",source:"ECDC Surveillance report 2014, except Poland (2013)",url:"https://correctiv.org/en/investigations/superbugs/atlas/superbug-atlas-streptococcus-pneumoniae-penicillin/"},nts:{title:"Salmonella – Fluoroquinolones",subtitle:"Salmonella vs fluoroquinolones",text:"Resistance to fluoroquinolones in percent. Of all infections with this bacterium, this percentage was resistant to this antibiotic.",source:"WHO Surveillance report 2014",url:"https://correctiv.org/en/investigations/superbugs/atlas/superbug-atlas-salmonella-fluoroquinolones/"},shigella:{title:"Shigella – Fluoroquinolones",subtitle:"Shigella vs fluoroquinolones",text:"Resistance to fluoroquinolones in percent. Of all infections with this bacterium, this percentage was resistant to this antibiotic.",source:"WHO Surveillance report 2014",url:"https://correctiv.org/en/investigations/superbugs/atlas/superbug-atlas-shigella-fluoroquinolones/"},neisseria:{title:"Neisseria gonorrhoea – Cephalosporins",subtitle:"Neisseria gonorrhoea vs cephalosporins",text:"Resistance to 3rd generation cephalosporins in percent. Of all infections with this bacterium, this percentage was resistant to this antibiotic.",source:"WHO Surveillance report 2014",url:"https://correctiv.org/en/investigations/superbugs/atlas/superbug-atlas-neisseria-gonorrhoea-cephalosporins/"}};var COLOR_SCHEMES={BrBG:d3.schemeBrBG[9],PRGn:d3.schemePRGn[9],PiYG:d3.schemePiYG[9],PuOr:d3.schemePuOr[9],RdBu:d3.schemeRdBu[9],RdGy:d3.schemeRdGy[9],RdYlBu:d3.schemeRdYlBu[9],RdYlGn:d3.schemeRdYlGn[9],Spectral:d3.schemeSpectral[9],Blues:d3.schemeBlues[9],Greens:d3.schemeGreens[9],Greys:d3.schemeGreys[9],Oranges:d3.schemeOranges[9],Purples:d3.schemePurples[9],Reds:d3.schemeReds[9],BuGn:d3.schemeBuGn[9],BuPu:d3.schemeBuPu[9],GnBu:d3.schemeGnBu[9],OrRd:d3.schemeOrRd[9],PuBuGn:d3.schemePuBuGn[9],PuBu:d3.schemePuBu[9],PuRd:d3.schemePuRd[9],RdPu:d3.schemeRdPu[9],YlGnBu:d3.schemeYlGnBu[9],YlGn:d3.schemeYlGn[9],YlOrBr:d3.schemeYlOrBr[9],YlOrRd:d3.schemeYlOrRd[9]};